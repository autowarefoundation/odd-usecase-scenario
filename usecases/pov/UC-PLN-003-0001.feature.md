# Feature: Lane keeping 

Ensures that ego is able to drive in the center of the lane under different conditions. This is required to prevent ego from sticking out to neighboring lanes or exiting the road unintentionally.

## Scenario Outline: Lane keeping on narrowing lane

Confirm that ego is able to continue driving on the center of the lane when the width of the lane becomes narrower.

* Given a lane with width <initial_lane_width>
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego approaches a new lane section with width <lane_width>, smaller than <initial_lane_width>
* Then Ego adjusts its lateral position as required to drive in the center of the new lane section
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | initial_lane_width | lane_width | d_lane_center_offset |
  | -------- | ------------------ | ---------- | -------------------- |
  | 70 km/h  | 4.5 m              | 3.0 m      | 0.15 m               |
  | 90 km/h  | 4.2 m              | 3.0 m      | 0.15 m               |
  | 100 km/h | 4.0 m              | 3.0 m      | 0.15 m               |


## Scenario Outline: Lane keeping on widening lane

Confirm that ego is able to continue driving on the center of the lane when the width of the lane becomes wider.

* Given a lane with width <initial_lane_width>
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego approaches a new lane section with width <lane_width>, greater than <initial_lane_width>
* Then Ego adjusts its lateral position as required to drive in the center of the new lane section
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | initial_lane_width | lane_width | d_lane_center_offset |
  | -------- | ------------------ | ---------- | -------------------- |
  | 70 km/h  | 3.7 m              | 4.5 m      | 0.15 m               |
  | 90 km/h  | 3.5 m              | 4.5 m      | 0.15 m               |
  | 100 km/h | 3.0 m              | 4.5 m      | 0.15 m               |


## Scenario Outline: Lane keeping with missing left lane marker

Confirm that ego is able to continue driving on the center of the lane when the left lane marker is temporarily missing.

* Given a lane with a section of <d_missing_lane_marker> with missing left lane marker
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego enters the area with missing lane marker
* Then Ego continues driving on the center of the driving lane
* And Ego reaches the section with both lane markers present
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | d_missing_lane_marker | d_lane_center_offset |
  | -------- | --------------------- | -------------------- |
  | 70 km/h  | 50 m                  | 0.15 m               |
  | 90 km/h  | 75 m                  | 0.15 m               |
  | 100 km/h | 100 m                 | 0.15 m               |


## Scenario Outline: Lane keeping with missing right lane marker

Confirm that ego is able to continue driving on the center of the lane when the right lane marker is temporarily missing.

* Given a lane with a section of <d_missing_lane_marker> with missing right lane marker
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego enters the area with missing lane marker
* Then Ego continues driving on the center of the driving lane
* And Ego reaches the section with both lane markers present
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | d_missing_lane_marker | d_lane_center_offset |
  | -------- | --------------------- | -------------------- |
  | 70 km/h  | 50 m                  | 0.15 m               |
  | 90 km/h  | 75 m                  | 0.15 m               |
  | 100 km/h | 100 m                 | 0.15 m               |


## Scenario Outline: Lane keeping with both lane markers missing

Confirm that ego is able to continue driving on the center of the lane when both lane markers are temporarily missing.

* Given a lane with a section of <d_missing_lane_marker> with both lane markers missing
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego enters the area with missing lane markers
* Then Ego continues driving on the center of the driving lane
* And Ego reaches the section with both lane markers present
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | d_missing_lane_marker | d_lane_center_offset |
  | -------- | --------------------- | -------------------- |
  | 70 km/h  | 50 m                  | 0.15 m               |
  | 90 km/h  | 75 m                  | 0.15 m               |
  | 100 km/h | 100 m                 | 0.15 m               |


## Scenario Outline: Lane keeping on left curve

Confirm that ego is able to continue driving on the center of the lane during left curves.

* Given a lane with a left curve section of curvature <road_curvature> at its center
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego enters the curve area
* Then Ego continues driving on the center of the driving lane
* And Ego reaches the end of the curve section
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | road_curvature | d_lane_center_offset |
  | -------- | -------------- | -------------------- |
  | 70 km/h  | 0.025 1/m      | 0.15 m               |
  | 90 km/h  | 0.01 1/m       | 0.15 m               |
  | 100 km/h | 0.005 1/m      | 0.15 m               |


## Scenario Outline: Lane keeping on right curve

Confirm that ego is able to continue driving on the center of the lane during right curves.

* Given a lane with a right curve section of curvature <road_curvature> at its center
* And Ego is driving on the lane at a velocity <vxi_ego>

* When Ego enters the curve area
* Then Ego continues driving on the center of the driving lane
* And Ego reaches the end of the curve section
* And Ego drives continuously at all times
* And Ego drives within <d_lane_center_offset> from the lane center at all times

![Overview](./images/UC-PLN-001-0001.drawio.svg)

### Examples:

  | vxi_ego  | road_curvature | d_lane_center_offset |
  | -------- | -------------- | -------------------- |
  | 70 km/h  | -0.025 1/m     | 0.15 m               |
  | 90 km/h  | -0.01 1/m      | 0.15 m               |
  | 100 km/h | -0.005 1/m     | 0.15 m               |
